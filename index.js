import{_ as B,l as q,aw as A,ax as v,ay as I,ab as R,o as r,c,a as t,w as i,i as F,p as w,f as u,O as J,Q as O,B as T,ai as P,at as U,F as y,j as b,t as p,h as d,C as j,I as z,s as D,Z as G,N as M,x as E,Y as W}from"./vendor.31ac415e.js";import{D as Q,A as Y,P as Z,a as H}from"./passcard.f8552f1c.js";import{p as K}from"./passcardMixin.b165dfc2.js";const X={mixins:[K],computed:{...q(["user"])},setup(){const{locale:e,t:a}=A({inheritLocale:!0,fallbackRoot:!1,missingWarn:!1,fallbackWarn:!1});return{locale:e,t:a}},methods:{ready(){let e=this;Q.jsapi_ticket({url:window.location.href.split("#")[0]}).then(a=>{v.config({agentId:a.data.agentId,corpId:a.data.corpId,timeStamp:a.data.timeStamp,nonceStr:a.data.nonceStr,signature:a.data.signature,type:0,jsApiList:["device.geolocation.get"]}),v.error(function(o){alert("dd error: "+JSON.stringify(o))})}).then(a=>{v.ready(function(){v.device.geolocation.get({targetAccuracy:200,coordinate:1,withReGeocode:!0,useCache:!1,onSuccess:function(o){if(I(e.user.id+"\u9489\u9489\u8FD4\u56DE\u7684\u5185\u5BB9: "+JSON.stringify(o)),e.$route.query.type&&alert("on Success"+JSON.stringify(o)),o.errorCode>0){e.$toast({duration:5e3,message:o.errorMessage});return}o.province===""?Y.regeo({longitude:o.longitude,latitude:o.latitude,remark:e.user.id}).then(l=>{let n=l.data.regeocode.addressComponent;e.punch.currentLocation=n.province+n.city+n.district,e.punch.city=n.city,e.punch.districtAdcode=n.adcode,e.punch.province=n.province,e.punch.district=n.district,e.submitBtn=!1}):(e.punch.currentLocation=o.province+o.city+o.district,e.punch.city=o.city,e.punch.districtAdcode=o.districtAdCode===void 0?o.districtAdcode:o.districtAdCode,e.punch.province=o.province,e.punch.district=o.district,e.submitBtn=!1)},onFail:function(o){alert("dd error:"+JSON.stringify(o))}})})})},promiseValidator(){return this.promiseCheckbox===!0?!0:(this.$toast.fail("\u8BF7\u52FE\u9009\u627F\u8BFA"),!1)},onSubmit(){this.$showLoading(),window.localStorage.setItem("punch",JSON.stringify(this.punch)),Z.add(this.punch).then(e=>{R.success("\u6253\u5361\u6210\u529F"),this.disabled=!0}).finally(()=>{this.$hideLoading(),this.doing=!1})},initCodeFromPasscardstaus(){H.my().then(e=>{this.setPasscardStatus(e.data),this.punch.healthCode=e.data.heathCodeStatus}).catch().finally(()=>{this.init=!0})}},data(){return{isShow:!1,isShowLoading:!0,healthCodeEnum:["green","red","yellow","orange","none"],init:!1,disabled:!1,promiseCheckbox:!1,submitBtn:!0,punch:{currentLocation:"\u83B7\u53D6\u5931\u8D25\uFF0C\u8BF7\u5728\u624B\u673A\u4E2D\u7ED9\u4E88\u9489\u9489\u4F4D\u7F6E\u6743\u9650"}}},mounted(){this.$setNavigateTitle("\u5065\u5EB7\u6253\u5361"),this.ready();let e=JSON.parse(window.localStorage.getItem("punch"));e&&(this.punch={...e,...this.punch}),this.initCodeFromPasscardstaus()},watch:{user:{handler(e){e.id&&(this.isShowLoading=!1)},immediate:!0}}},$={key:0,class:"loading"},ee=d("\u5982\u679C\u52A0\u8F7D\u4E0D\u51FA\u6765\uFF0C\u53EF\u7A0D\u540E\u91CD\u8BD5"),te={key:1,class:"punch-form"},ne={style:{padding:"18px"}},ie={key:1,class:"stu-sign"},ae={class:"tn-sign"},oe={class:"text-center is-success"},se=u("div",{class:"text-center is-success"},[u("span",{class:"title"},"\u6253\u5361\u6210\u529F")],-1),le={class:"text-center is-success"},re=d(" \u67E5\u770B\u5386\u53F2 ");function ce(e,a,o,l,n,x){const V=J,C=O,m=j,k=z,h=D,f=W,g=G,_=M,L=E,S=T,N=P;return n.isShowLoading?(r(),c("div",$,[t(V,{size:"24px",vertical:""},{default:i(()=>[ee]),_:1})])):(r(),c("div",te,[t(C,{wrapable:"",scrollable:!1,text:l.t("punch.notice"),"left-icon":"info-o"},null,8,["text"]),!n.disabled&&n.init?(r(),F(N,{key:0,"scroll-to-error":"",onSubmit:x.onSubmit},{default:i(()=>[t(h,{inset:"",style:{"margin-top":"8px"}},{default:i(()=>[t(m,{title:l.t("punch.userName"),value:e.user.userName},null,8,["title","value"]),t(m,{title:l.t("punch.unitName"),value:e.user.unitName},null,8,["title","value"]),t(m,{title:l.t("punch.id"),value:e.user.id},null,8,["title","value"]),t(m,{title:l.t("punch.userType.label"),value:l.t("punch.userType."+e.user.userType)},null,8,["title","value"]),t(m,{title:l.t("punch.currentLocation"),value:n.punch.currentLocation},U({_:2},[n.punch.currentLocation==="\u83B7\u53D6\u5931\u8D25\uFF0C\u8BF7\u5728\u624B\u673A\u4E2D\u7ED9\u4E88\u9489\u9489\u4F4D\u7F6E\u6743\u9650"?{name:"right-icon",fn:i(()=>[t(k,{color:"red",name:"warning-o",size:"30px"})]),key:"0"}:void 0]),1032,["title","value"])]),_:1}),t(h,{title:l.t("punch.healthCode.name"),inset:""},{default:i(()=>[t(_,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],name:"healthCode",required:""},{input:i(()=>[t(g,{modelValue:n.punch.healthCode,"onUpdate:modelValue":a[0]||(a[0]=s=>n.punch.healthCode=s)},{default:i(()=>[(r(),c(y,null,b(4,s=>t(f,{name:s-1},{default:i(()=>[d(p(l.t(`punch.healthCode.item[${s-1}]`)),1)]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title"]),t(C,{scrollable:!1,text:l.t("punch.healthCode.notice"),"left-icon":"info-o",wrapable:""},null,8,["text"]),t(h,{title:l.t("punch.healthReport.label"),inset:""},{default:i(()=>[t(_,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],name:"healthReport",required:""},{input:i(()=>[t(g,{modelValue:n.punch.healthReport,"onUpdate:modelValue":a[1]||(a[1]=s=>n.punch.healthReport=s)},{default:i(()=>[(r(),c(y,null,b(5,s=>t(f,{name:s-1},{default:i(()=>[d(p(l.t(`punch.healthReport.item[${s-1}]`)),1)]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title"]),t(h,{title:l.t("punch.currentLiving.label"),inset:""},{default:i(()=>[t(_,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],name:"currentLiving",required:""},{input:i(()=>[t(g,{modelValue:n.punch.currentLiving,"onUpdate:modelValue":a[2]||(a[2]=s=>n.punch.currentLiving=s)},{default:i(()=>[(r(),c(y,null,b(6,s=>t(f,{name:s-1},{default:i(()=>[d(p(l.t(`punch.currentLiving.item[${s-1}]`)),1)]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title"]),t(h,{title:l.t("punch.last14days.label"),inset:""},{default:i(()=>[t(_,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],name:"last14days",required:""},{input:i(()=>[t(g,{modelValue:n.punch.last14days,"onUpdate:modelValue":a[3]||(a[3]=s=>n.punch.last14days=s)},{default:i(()=>[(r(),c(y,null,b(3,s=>t(f,{name:s-1},{default:i(()=>[d(p(l.t(`punch.last14days.item[${s-1}]`)),1)]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title"]),t(h,{inset:"",title:" "},{default:i(()=>[t(_,{rules:[{validator:x.promiseValidator}],"label-width":"200",name:"checkbox"},{"left-icon":i(()=>[t(L,{modelValue:n.promiseCheckbox,"onUpdate:modelValue":a[4]||(a[4]=s=>n.promiseCheckbox=s),shape:"square"},null,8,["modelValue"])]),extra:i(()=>[u("div",{onClick:a[5]||(a[5]=()=>n.promiseCheckbox=!n.promiseCheckbox)},p(l.t("punch.promise")),1)]),_:1},8,["rules"])]),_:1}),u("div",ne,[t(S,{disabled:n.submitBtn,block:"","native-type":"submit",round:"",type:"primary"},{default:i(()=>[d(p(l.t("punch.submit")),1)]),_:1},8,["disabled"])])]),_:1},8,["onSubmit"])):w("",!0),n.disabled?(r(),c("div",ie,[u("div",ae,[u("div",oe,[t(k,{name:"checked",size:"108px"})]),se,u("div",le,[t(S,{block:"",round:"",style:{margin:"30px 10px"},to:"/punch/my",type:"primary"},{default:i(()=>[re]),_:1})])])])):w("",!0)]))}const pe=B(X,[["render",ce]]);export{pe as default};
